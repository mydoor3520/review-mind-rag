# review-mind-rag docker-compose.yml
# Synology NAS (DS220+) 배포용
#
# 실행: docker-compose up -d
# 종료: docker-compose down
# 로그: docker-compose logs -f
# 재빌드: docker-compose up -d --build

version: "3.8"

services:
  review-mind:
    build:
      context: .
      dockerfile: Dockerfile
    image: jeonghopak/review-mind-rag:latest
    container_name: review-mind-rag
    restart: "no"  # 수동 관리
    ports:
      - "8510:8501"
    env_file:
      - .env
    environment:
      # ChromaDB 설정 (컨테이너 내부 경로)
      - CHROMA_PERSIST_DIR=/app/chroma_db
      # Python 설정
      - PYTHONPATH=/app
      - PYTHONUNBUFFERED=1
    volumes:
      # 데이터 영속성을 위한 볼륨 마운트
      - ./chroma_db:/app/chroma_db
      - ./data:/app/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - review-mind-network

networks:
  review-mind-network:
    name: review-mind-network
    driver: bridge
