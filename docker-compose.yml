# review-mind-rag docker-compose.yml
# 
# 실행: docker-compose up -d
# 종료: docker-compose down
# 로그: docker-compose logs -f
# 재빌드: docker-compose up -d --build

version: "3.8"

services:
  review-mind:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: review-mind-rag
    restart: unless-stopped
    ports:
      - "${STREAMLIT_PORT:-8501}:8501"
    environment:
      # OpenAI API 설정
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-text-embedding-3-small}
      - LLM_MODEL=${LLM_MODEL:-gpt-4o-mini}
      # ChromaDB 설정
      - CHROMA_PERSIST_DIR=/app/chroma_db
      - CHROMA_COLLECTION_NAME=${CHROMA_COLLECTION_NAME:-reviews}
      # 데이터 설정
      - DATA_DIR=/app/data
      - RAW_DATA_DIR=/app/data/raw
      - PROCESSED_DATA_DIR=/app/data/processed
      # Python 설정
      - PYTHONPATH=/app
      - PYTHONUNBUFFERED=1
    volumes:
      # 데이터 영속성을 위한 볼륨 마운트
      - review-mind-data:/app/data
      - review-mind-chroma:/app/chroma_db
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - review-mind-network

volumes:
  review-mind-data:
    name: review-mind-data
  review-mind-chroma:
    name: review-mind-chroma

networks:
  review-mind-network:
    name: review-mind-network
    driver: bridge
